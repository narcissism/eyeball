<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eyeball</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #111;
}
canvas { display:block; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let w, h;
function resize(){
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ---------- MOUSE ---------- */
let mouse = { x: w/2, y: h/2 };
window.addEventListener("mousemove", e=>{
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});

/* ---------- TIME ---------- */
let time = 0;
let startTime = performance.now();

/* ---------- EYE ---------- */
const eye = {
  radius: 120,
  irisRadius: 45,
  pupilRadius: 18,
  minPupil: 10,
  maxPupil: 28,
  rotX: 0,
  rotY: 0,
  targetRotX: 0,
  targetRotY: 0
};

/* ---------- VEINS ---------- */
const vessels = [];
for(let i=0;i<28;i++){
  vessels.push({
    baseAngle: Math.random() * Math.PI * 2,
    length: 40 + Math.random() * 60,
    wiggle: Math.random() * 0.5 + 0.2,
    pulsePhase: Math.random() * Math.PI * 2
  });
}

/* ---------- TEARS ---------- */
const tears = [];
let tearAmount = 0;

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,w,h);
  time += 0.02;

  const cx = w/2;
  const cy = h/2;

  /* ---------- LOOK ROTATION ---------- */
  const dx = mouse.x - cx;
  const dy = mouse.y - cy;

  eye.targetRotX = Math.max(-1, Math.min(1, dx / 300));
  eye.targetRotY = Math.max(-1, Math.min(1, dy / 300));

  eye.rotX += (eye.targetRotX - eye.rotX) * 0.08;
  eye.rotY += (eye.targetRotY - eye.rotY) * 0.08;

  /* ---------- PUPIL DILATION ---------- */
  const dist = Math.hypot(dx, dy);
  const norm = Math.min(dist / 400, 1);
  const targetPupil =
    eye.maxPupil - norm * (eye.maxPupil - eye.minPupil);
  eye.pupilRadius += (targetPupil - eye.pupilRadius) * 0.08;

  /* ---------- TEAR TIMER ---------- */
  const elapsed = (performance.now() - startTime) / 1000;
  if(elapsed > 15){
    tearAmount = Math.min(1, tearAmount + 0.002);

    if(Math.random() < 0.015 * tearAmount){
      tears.push({
        x: cx + eye.rotX * 40 + (Math.random() - 0.5) * 20,
        y: cy + eye.radius * 0.95,
        vy: 0.3 + Math.random() * 0.3,
        r: 3 + Math.random() * 2,
        life: 1
      });
    }
  }

  ctx.save();
  ctx.translate(cx, cy);

  /* ---------- SPHERE ---------- */
  const lightX = -eye.rotX * eye.radius * 0.4;
  const lightY = -eye.rotY * eye.radius * 0.4;

  const scleraGrad = ctx.createRadialGradient(
    lightX, lightY, eye.radius * 0.2,
    0,0, eye.radius
  );
  scleraGrad.addColorStop(0,"#fff");
  scleraGrad.addColorStop(1,"#d6d6d6");

  ctx.fillStyle = scleraGrad;
  ctx.beginPath();
  ctx.arc(0,0,eye.radius,0,Math.PI*2);
  ctx.fill();

  /* ---------- VEINS ---------- */
  vessels.forEach(v=>{
    v.pulsePhase += 0.015;
    const pulse = Math.sin(v.pulsePhase + time) * 0.6 + 1;

    ctx.strokeStyle = `rgba(170,60,60,${0.22 * pulse})`;
    ctx.lineWidth = pulse * 1.1;

    let a = v.baseAngle + eye.rotX * 1.2;
    let r = eye.radius * 0.9;

    ctx.beginPath();
    ctx.moveTo(Math.cos(a)*r, Math.sin(a)*r);

    for(let i=0;i<6;i++){
      r -= (v.length * pulse) / 6;
      a += Math.sin(i + eye.rotY * 4) * v.wiggle;
      ctx.lineTo(Math.cos(a)*r, Math.sin(a)*r);
    }
    ctx.stroke();
  });

  /* ---------- IRIS & PUPIL 3D DEFORMATION ---------- */
  const irisX = eye.rotX * 22;
  const irisY = eye.rotY * 22;

  const squashX = 1 - Math.abs(eye.rotX) * 0.35;
  const squashY = 1 - Math.abs(eye.rotY) * 0.35;

  ctx.save();
  ctx.translate(irisX, irisY);
  ctx.scale(squashX, squashY);

  /* Iris */
  const irisGrad = ctx.createRadialGradient(
    -10, -10, 6,
    0,0, eye.irisRadius
  );
  irisGrad.addColorStop(0,"#3b2a14");
  irisGrad.addColorStop(0.4,"#6f4e2c");
  irisGrad.addColorStop(0.8,"#9b7b3c");
  irisGrad.addColorStop(1,"#2a1b0c");

  ctx.fillStyle = irisGrad;
  ctx.beginPath();
  ctx.arc(0,0,eye.irisRadius,0,Math.PI*2);
  ctx.fill();

  /* Iris fibers */
  ctx.strokeStyle = "rgba(0,0,0,0.25)";
  for(let i=0;i<45;i++){
    const a = (i/45)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(Math.cos(a)*6, Math.sin(a)*6);
    ctx.lineTo(Math.cos(a)*eye.irisRadius, Math.sin(a)*eye.irisRadius);
    ctx.stroke();
  }

  /* Pupil */
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(0,0,eye.pupilRadius,0,Math.PI*2);
  ctx.fill();

  ctx.restore();

  /* ---------- HIGHLIGHT ---------- */
  ctx.fillStyle = "rgba(255,255,255,0.6)";
  ctx.beginPath();
  ctx.arc(lightX - 15, lightY - 15, 14, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();

  /* ---------- TEARS ---------- */
  ctx.fillStyle = "rgba(180,220,255,0.6)";
  tears.forEach(t=>{
    t.y += t.vy;
    t.vy += 0.02;
    t.life -= 0.003;

    ctx.beginPath();
    ctx.ellipse(t.x, t.y, t.r, t.r * 1.6, 0, 0, Math.PI*2);
    ctx.fill();
  });

  for(let i=tears.length-1;i>=0;i--){
    if(tears[i].life <= 0 || tears[i].y > h){
      tears.splice(i,1);
    }
  }

  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
